# STR多人身份鉴定中的特征工程与符号解释

## STR数据结构与符号定义

### 基础概念与符号解释

**STR (Short Tandem Repeat)**：短串联重复序列，是DNA中重复单元长度为2-6个碱基对的串联重复序列。在法医学中，STR分析是个体识别的黄金标准。

**关键符号定义：**

- **$A_{i,j}$**：第$i$个样本在第$j$个STR标记上的等位基因集合
- **$H_{i,j,k}$**：第$i$个样本在第$j$个标记上第$k$个等位基因的峰高值
- **$OL$**：Off-Ladder等位基因，表示脱落或超出常规分型范围的等位基因
- **$y$**：样本中的贡献者人数，取值范围为$\{1,2,3,4\}$
- **$M = \{D3S1358, vWA, D8S1179, ..., FGA\}$**：16个STR标记位点集合

### 数据集结构分析

**样本命名格式：**
每个样本文件名遵循格式：`编号-混合ID-贡献者信息-实验参数.fsa`

例如：`B01_RD14-0003-44_45-1;1-M2S30-0.25IP-Q3.0_002.5sec.fsa`

其中：

- `44_45`：表示贡献者ID为44和45
- `1;1`：表示两个贡献者的DNA比例为1:1
- 因此该样本的真实标签为$y = 2$

**数据矩阵结构：**
每个样本在每个STR标记上最多可检测31个等位基因位置，形成数据结构：

$$
\mathbf{X}_{sample} = \begin{bmatrix}
A_{1,1} & H_{1,1,1} & A_{1,2} & H_{1,1,2} & \cdots & A_{1,31} & H_{1,1,31} \\
A_{2,1} & H_{2,1,1} & A_{2,2} & H_{2,1,2} & \cdots & A_{2,31} & H_{2,1,31} \\
\vdots & \vdots & \vdots & \vdots & \ddots & \vdots & \vdots \\
A_{16,1} & H_{16,1,1} & A_{16,2} & H_{16,1,2} & \cdots & A_{16,31} & H_{16,1,31}
\end{bmatrix}
$$

## 特征工程设计

### 等位基因计数特征

对于每个STR标记$j \in \{1,2,...,16\}$，提取以下等位基因相关特征：

**基础计数特征：**

$$
count_j = |\{k : A_{i,j,k} \neq null, k \in [1,31]\}|
$$

$$
unique_j = |unique(\{A_{i,j,k} : A_{i,j,k} \neq null\})|
$$

**OL等位基因特征：**

$$
ol\_count_j = |\{k : A_{i,j,k} = OL\}|
$$

$$
ol\_ratio_j = \frac{ol\_count_j}{count_j}
$$

**超额等位基因检测：**
理论上，$n$个贡献者最多产生$2n$个等位基因。定义超额指示函数：

$$
exceed\_X_j = \mathbb{I}[count_j > X], \quad X \in \{2,4,6,8\}
$$

**期望比值特征：**

$$
expect\_ratio_j = \frac{count_j}{2 \times y}
$$

### 峰高统计特征

对于每个标记$j$，设有效峰高集合为$\mathcal{H}_j = \{H_{i,j,k} : H_{i,j,k} > 0\}$：

**基础统计量：**

$$
mean_j = \frac{1}{|\mathcal{H}_j|} \sum_{h \in \mathcal{H}_j} h
$$

$$
std_j = \sqrt{\frac{1}{|\mathcal{H}_j|-1} \sum_{h \in \mathcal{H}_j} (h - mean_j)^2}
$$

$$
cv_j = \frac{std_j}{mean_j}
$$

**极值特征：**

$$
max_j = \max(\mathcal{H}_j), \quad min_j = \min(\mathcal{H}_j)
$$

$$
range_j = max_j - min_j
$$

**排序峰高特征：**
设$\mathcal{H}_j^{sorted} = \{h^{(1)}_j, h^{(2)}_j, h^{(3)}_j, h^{(4)}_j\}$为按峰高降序排列的前4个峰值：

$$
peak\_k_j = h^{(k)}_j, \quad k \in \{1,2,3,4\}
$$

$$
ratio_{12}_j = \frac{h^{(1)}_j}{h^{(2)}_j}, \quad ratio_{23}_j = \frac{h^{(2)}_j}{h^{(3)}_j}
$$

**分布形状特征：**

$$
skew_j = \frac{\mathbb{E}[(H_j - \mu_j)^3]}{\sigma_j^3}
$$

$$
kurt_j = \frac{\mathbb{E}[(H_j - \mu_j)^4]}{\sigma_j^4} - 3
$$

### 全局整合特征

**跨标记统计：**

$$
total\_alleles = \sum_{j=1}^{16} count_j
$$

$$
total\_ol = \sum_{j=1}^{16} ol\_count_j
$$

$$
total\_height = \sum_{j=1}^{16} \sum_{h \in \mathcal{H}_j} h
$$

**全局比例特征：**

$$
ol\_ratio\_global = \frac{total\_ol}{total\_alleles}
$$

$$
diversity = \frac{1}{16} \sum_{j=1}^{16} \frac{unique_j}{count_j}
$$

## 数据预处理流程

### 异常值处理

对所有峰高相关特征$x_{height}$，采用99%分位数截尾：

$$
x_{height}^{clean} = \min(x_{height}, Q_{0.99}(x_{height}))
$$

### 对数变换

对所有正值峰高特征进行对数变换，减少偏度：

$$
x_{height}^{log} = \log(1 + x_{height}^{clean})
$$

### 特征选择

使用方差阈值法去除低信息量特征：

$$
\mathcal{F}_{selected} = \{f : Var(f) > \epsilon\}, \quad \epsilon = 1 \times 10^{-5}
$$

## 特征空间维度分析

**单标记特征数量：**

- 等位基因计数特征：7个
- 峰高统计特征：15个
- 排序峰高特征：8个
- 比值特征：4个
- **单标记小计：约34个特征**

**总特征维度：**

- 16个标记 × 34个特征/标记 = 544个标记特征
- 全局特征：6个
- **预处理前总计：约550个特征**
- **方差过滤后：约480个有效特征**
